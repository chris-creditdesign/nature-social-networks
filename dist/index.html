<style scoped>
.status-message{border:1px solid #c00;background:#fac7c7;padding:10px}.outerwrapper{width:100%;min-height:900px;position:relative;border:1px solid #c8c7cf}.outerwrapper h2,.outerwrapper h3,.outerwrapper p{padding:10px 10px 0;margin:0}.outerwrapper .chooseNetwork{text-align:center}.outerwrapper .chooseNetwork ul#networkSelect{padding:0 160px}.outerwrapper .chooseNetwork ul#networkSelect li{display:inline;margin:0 10px}.outerwrapper .chooseNetwork ul#networkSelect span{position:relative;top:4px;height:20px;width:20px}.outerwrapper .chooseNetwork ul#networkSelect input{outline:0!important;opacity:0;filter:alpha(opacity=0);zoom:1;float:left;margin-left:-40px}.outerwrapper .chooseNetwork ul#networkSelect input+label>span>svg>polygon{opacity:0}.outerwrapper .chooseNetwork ul#networkSelect input:checked+label>span>svg>polygon{opacity:1}.outerwrapper .options ol#optionDescriptions{padding-left:40px}.outerwrapper .options ol#optionDescriptions li{list-style-type:decimal}.outerwrapper .chart svg text{font-size:.8em}.outerwrapper .chart svg text.options{font-size:1.2em}
</style>
<div class="outerwrapper">
	<div class="chart"></div>

	<div class="chooseNetwork"></div>
	<div class="options"></div>
</div>


<!--[if gt IE 8]><!-->
<script type="text/javascript">
function buildCheckboxes (allSites, colour, lowOpacityLevel, strokeColour) {
	/* Create checkboxes for each site */
	d3.select(".chooseNetwork")
		.append("ul")
		.attr("id","networkSelect")
		.selectAll('li')
	  .data(allSites)
	  	.enter()
		.append("li")
		.html(function (d, i) {
			var innerHTML = "<input type='checkbox' id='" + d + "' name='" + d + "' checked><label for='" + d + "'><span><svg height='20' width='20'><circle cx='10' cy='10' r='10' fill='" + colour[i] + "' class='dot" + i + "' opacity='" + lowOpacityLevel + "'></circle><polygon fill='#fff' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon></svg></span> " + d + "</label>";

			return innerHTML;
		});
}
function fadeOutArcs (lowOpacityLevel) {
	// body...
	function fadeOut (x) {
		d3.select(".chart").select("svg").selectAll(x)
			.transition()
			.duration(200)
			.attr('opacity', lowOpacityLevel);
	}

	function fadeIn (x) {
		d3.select(".chart").select("svg").selectAll(x)
			.transition()
			.duration(200)
			.attr('opacity', '0');
	}

	jQuery('#networkSelect').change(
		function () {
			if (jQuery('#Twitter').is(':checked')) {
				fadeOut('path.arc0');
			} else {
				fadeIn('path.arc0')
			}
			if (jQuery('#Facebook').is(':checked')) {
				fadeOut('path.arc1');
			} else {
				fadeIn('path.arc1')
			}
			if (jQuery('#Academiaedu').is(':checked')) {
				fadeOut('path.arc2');
			} else {
				fadeIn('path.arc2')
			}
			if (jQuery('#ResearchGate').is(':checked')) {
				fadeOut('path.arc3');
			} else {
				fadeIn('path.arc3')
			}
			if (jQuery('#LinkedIn').is(':checked')) {
				fadeOut('path.arc4');
			} else {
				fadeIn('path.arc4')
			}
			if (jQuery('#Mendeley').is(':checked')) {
				fadeOut('path.arc5');
			} else {
				fadeIn('path.arc5')
			}
		}
	);
}

function buildSVG(margin, width, height) {
	d3.select(".chart").append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom);
}
function buildTicks (margin, width, height, radiusScale, scaleLines) {
	var myTicks = d3.select(".chart").select("svg").append("g")
		.attr("transform", "translate(" + (width + margin.left + margin.right) / 2 + "," + (height + margin.top + margin.bottom) / 2 + ")");

	myTicks.selectAll('text')
	  .data(scaleLines)
		.enter()
		.append('svg:text')
		.attr('y', function(d) { return -1 * radiusScale(d) })
		.attr("text-anchor", "middle")
		.attr("dy", ".35em")
		.text(function (d) {
			return d + "%";
		});
}
function buildList (options) {
	/* Create numbered list for options */
	d3.select(".options")
		.append("ol")
		.attr("id","optionDescriptions")
		.selectAll('li')
	  .data(options)
	  	.enter()
		.append("li")
		.html(function (d, i) {
			return d;
		});
}
function buildLabels (margin, width, height, radiusScale, scaleLines, options, baseRad) {
	var myLabels = d3.select(".chart").select("svg").append("g")
		.attr("transform", "translate(" + (width + margin.left + margin.right) / 2 + "," + (height + margin.top + margin.bottom) / 2 + ")");

	myLabels.selectAll('text')
		.data(options)
		.enter()
		.append('svg:text')
		.attr('class','options')
		.attr('x', function (d,i) {
			var xPos = radiusScale(d3.max(scaleLines)*1.1) * Math.cos((baseRad*i) - (baseRad*4.25));
			return xPos;
		})
		.attr('y', function (d,i) {
			var yPos = radiusScale(d3.max(scaleLines)*1.1) * Math.sin((baseRad*i) - (baseRad*4.25));
			return yPos;
		})
		.attr('text-anchor','middle')
		.attr('font-weight','bold')
		.attr("dy", ".35em")
		.text(function (d,i) {
			return (i+1);
		});
}
function buildLines (margin, width, height, radiusScale, scaleLines, dataSetLength, strokeColour, baseAngle) {
	var mylines = d3.select(".chart").select("svg").append("g")
			.attr("transform", "translate(" + (width + margin.left + margin.right) / 2 + "," + (height + margin.top + margin.bottom) / 2 + ")");

	for (var i = 0; i < dataSetLength; i++) {
		mylines.append('line')
			.attr('x1', '0')
			.attr('y1', '0')
			.attr('x2', '0')
			.attr('y2', -radiusScale(scaleLines[scaleLines.length-1]))
			.attr('stroke', strokeColour)
			.attr('stroke-width','1px')
			.attr('fill','none')
			.attr('transform','rotate(' +  (baseAngle + ((baseAngle*2) * i)) + ')');
	};
}
function buildScales (margin, width, height, radiusScale, scaleLines, strokeColour) {
	
	var myScale = d3.select(".chart").select("svg").append("g")		
		.attr("transform", "translate(" + (width + margin.left + margin.right) / 2 + "," + (height + margin.top + margin.bottom) / 2 + ")");

	myScale.selectAll('circle')
	  .data(scaleLines)
	  	.enter()
	  	.append('circle')
		.attr('cx', 0)
		.attr('cy', 0)
		.attr('r', function (d) {
			return radiusScale(d);
		})
		.attr('fill', 'none')
		.attr('stroke', strokeColour);
}
function buildGraphic(dataSet, allSites, margin, width, height, radiusScale, lowOpacityLevel, colour, baseRad, baseAngle) {
	
	var question1 = [];

	var myGroup = d3.select(".chart").select("svg").append("g")
		.attr("transform", "translate(" + (width + margin.left + margin.right) / 2 + "," + (height + margin.top + margin.bottom) / 2 + "), rotate(" + (baseAngle * -1) +")");
		
	var myArc = d3.svg.arc();
		myArc.innerRadius(0);
		myArc.outerRadius(function (d) { return radiusScale(d) } );
		myArc.startAngle(function (d,i) { return baseRad * i } );
		myArc.endAngle(function (d,i) { return baseRad * (i + 1) });

	/*var myArcTest = d3.svg.arc();
		myArc.innerRadius(0);
		myArc.outerRadius(function (d) { return radiusScale(d) } );
		myArc.startAngle(function (d,i) { return 0} );
		myArc.endAngle(function (d,i) { return baseRad });*/


	function buildArcs (i) {
		var thisClass = 'arc' + i;
	
		myGroup.selectAll('.' + thisClass)
		  .data(dataSet[i])
			.enter()
		  .append("path")
			.attr('d', myArc)
			.attr('class', thisClass)
			.attr('fill', colour[i])
			.attr('stroke', 'none')
			.attr('stroke-width', '1')
			.attr('opacity',lowOpacityLevel);
	}

	/*for (var i = 0; i < dataSet.length; i++) {
		var myArray = new Array;
		myArray.site = allSites[i]; 
		myArray.value = dataSet[i][0];

		question1.push(myArray);
	};*/

	// console.log(question1);

	/*employees.sort(function(a, b){
		return a.age-b.age
	})*/

	// console.log(Object.keys(question1)[0]);

	/*for (var key in question1) {
	   var obj = question1[key];
	   
	   for (var prop in obj) {
	      // important check that this is objects own property 
	      // not from prototype prop inherited
	      if(obj.hasOwnProperty(prop)){
	        alert(prop + " = " + obj[prop]);
	      }
	   }
	}*/

	for (var i = 0; i < dataSet.length; i++) {
		buildArcs(i);
	};
}
(function() {
		var init = function($)
		{
		/*	==================================================================================== */
		/*	GLOBAL VARIABLES FOR D3 */



		/*	Margin, Width and height */

		var outerWrapperWidth = $('.section').width();

		var margin = {top: 0, right: 100, bottom: 0, left: 100};
		var width = outerWrapperWidth - margin.left - margin.right;
		var height = (outerWrapperWidth*0.9) - margin.top - margin.bottom;
		/*	Global variable to control the length of D3 transitons */
		var duration = 450;

		/*  Colours for the bars */
		var colour = [
						"#00642D",
						"#95177E",
						"#F8B436",
						"#EB6B4B",
						"#3BAADC",
						"#96BE17"
					];
		var strokeColour = "#666";

		var scaleLines = [10,20,30,40,50,60,70];	

		var lowOpacityLevel = 0.7;

		var dataSet = [];
		var options = [];
		var allSites = [];

		var tableRows;
		var headerRows;
		var baseRad;
		var baseAngle;

		/*	==================================================================================== */
		/*	jQuery ready */

			/*	==================================================================================== */
			/*	Load D3 */
			/*	All of the D3/svg code is contained within the call back function */
			/*	Loading D3 into ie6-8 seems to cause a runtime error */
			// $.getScript("http://www.nature.com/polopoly_static/js/d3.v3.min.js", function() {
			$.getScript("https://poly-admin1.nature.com/polopoly_static/js/d3.v3.min.js", function() {
				// buildObjects(); 
				// buildArrays();
		
				/* Scale for pie radius */
				var radiusScale = d3.scale.linear()
									.domain([0,70])
									.range([0,(width/2)]);


				$.ajax({
					// url: "data/table.html",
					url: "https://poly-admin1.nature.com/preview/www/2.788/1.15117/7.18701",
					dataType: 'text',
					success: function (data) {

						// Store each row of the table in a var
						tableRows = $(data).find("tbody tr");
						
						for (var i = 0; i < tableRows.length; i++) {
							
							dataSet.push(new Array);

							for (var p = 1; p < (tableRows.eq(i).find('td').length -1); p++) {
								dataSet[i].push(tableRows.eq(i).find('td').eq(p).text());
							};

							allSites.push(tableRows.eq(i).find('td').eq(0).text())
						};

						headerRows = $(data).find("thead tr").find('th');

						for (var i = 1; i < headerRows.length -1; i++) {
							options.push(headerRows.eq(i).text());
						};

						baseRad = (Math.PI * 2) / dataSet[0].length;
						baseAngle = 180 / dataSet[0].length;

						buildSVG(margin, width, height);
						buildGraphic(dataSet, allSites, margin, width, height, radiusScale, lowOpacityLevel, colour, baseRad, baseAngle);
						buildScales(margin, width, height, radiusScale, scaleLines, strokeColour);
						buildLines(margin, width, height, radiusScale, scaleLines, dataSet[0].length, strokeColour, baseAngle);
						buildList(options);
						buildLabels(margin, width, height, radiusScale, scaleLines, options, baseRad);
						buildTicks(margin, width, height, radiusScale, scaleLines);
						buildCheckboxes(allSites, colour, lowOpacityLevel, strokeColour);
						fadeOutArcs(lowOpacityLevel);
					}


				});

			}); // End of d3js getscript call 

		/* End of active code */
		};


	setTimeout(function()
	{
	if (typeof jQuery !== 'undefined')
	{
		init(jQuery);
	} else
	{
		setTimeout(arguments.callee, 60);
	}
	}, 60);

})();
</script>
<!--<![endif]-->