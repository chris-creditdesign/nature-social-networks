<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Polopoly</title>
	<script src="http://nature.com/view/scripts/jquery/jquery-1.7.2.min.js" type="text/javascript"></script>
	<!-- <script src="https://poly-admin1.nature.com/polopoly_static/js/jquery-1.6.4.js" type="text/javascript"></script> -->

	<link rel="stylesheet" type="text/css" href="polopoly/reset.css" />
	<link rel="stylesheet" type="text/css" href="polopoly/html5.css" />
	<link rel="stylesheet" type="text/css" href="polopoly/layout.css" />	
	<link rel="stylesheet" type="text/css" href="polopoly/header.css" />	
	<link rel="stylesheet" type="text/css" href="polopoly/footer.css" />	
	<link rel="stylesheet" type="text/css" href="polopoly/main.css" />	
	<link rel="stylesheet" type="text/css" href="polopoly/news-main.css" />	
	<link rel="stylesheet" type="text/css" href="polopoly/comments.css" />	
	<link rel="stylesheet" type="text/css" href="polopoly/mobile.css" />	



</head>


<!--[if lt IE 6]><body class="lt-ie6"><![endif]-->
<!--[if IE 6]><body class="ie6"><![endif]-->
<!--[if IE 7]><body class="ie7"><![endif]-->
<!--[if IE 8]><body class="ie8"><![endif]-->
<!--[if gt IE 8]><body class="gt-ie8"><![endif]-->
<!--[if !IE]>--><body><!--<![endif]-->

<div id="constrain">

<div id="main">
	<div id="constrain-content" class="cleared">
		<div id="content" class="col">
			<article>
				<div id="article">
					<section>
						<div class="section">
							<div class="html-widget img-rigth">

<!-- ========= PASTED POLOPOLY HEADER ABOVE ========= -->







<style scoped>
.status-message {
  border: 1px solid #c00;
  background: #fac7c7;
  padding: 10px;
  font-style: italic;
}

.html-widget.img-right {
  margin: 0px 0px 10px 0px;
}

.outer-wrapper {
  display: none;
  width: 100%;
  min-height: 900px;
  position: relative;
  border: 1px solid #c8c7cf;
}
.outer-wrapper h2, .outer-wrapper p {
  padding: 10px 10px 0 10px;
  margin: 0;
}
.outer-wrapper h3 {
  padding: 0px;
  margin: 0px 20px;
}
@media (min-width: 630px) {
  .outer-wrapper .choose-network {
    -webkit-column-count: 2;
    -moz-column-count: 2;
    column-count: 2;
  }
}
.outer-wrapper ul {
  overflow: visible;
  padding-left: 10px;
}
.outer-wrapper ul li {
  list-style: none;
  padding: 2px 0px;
}
.outer-wrapper ol {
  padding-left: 40px;
}
.outer-wrapper ol li {
  list-style-type: decimal;
}
.outer-wrapper input[type="radio"] {
  border-radius: 50%;
  cursor: pointer;
  display: inline-block;
  height: 20px;
  margin-right: 15px;
  position: relative;
  width: 20px;
  -webkit-appearance: none;
}
.outer-wrapper input[type="radio"]:after {
  content: "\2713";
  font-size: 1em;
  display: inline-block;
  left: 0.25em;
  position: relative;
  top: 0.1em;
}
.outer-wrapper li:nth-of-type(1) input[type="radio"] {
  background-color: #3CBAC8;
}
.outer-wrapper li:nth-of-type(1) input[type="radio"]:after {
  color: #3CBAC8;
}
.outer-wrapper li:nth-of-type(1) input[type="radio"]:checked:after {
  color: white;
}
.outer-wrapper li:nth-of-type(2) input[type="radio"] {
  background-color: #B9B2D8;
}
.outer-wrapper li:nth-of-type(2) input[type="radio"]:after {
  color: #B9B2D8;
}
.outer-wrapper li:nth-of-type(2) input[type="radio"]:checked:after {
  color: white;
}
.outer-wrapper li:nth-of-type(3) input[type="radio"] {
  background-color: #F68628;
}
.outer-wrapper li:nth-of-type(3) input[type="radio"]:after {
  color: #F68628;
}
.outer-wrapper li:nth-of-type(3) input[type="radio"]:checked:after {
  color: white;
}
.outer-wrapper li:nth-of-type(4) input[type="radio"] {
  background-color: #B9D98B;
}
.outer-wrapper li:nth-of-type(4) input[type="radio"]:after {
  color: #B9D98B;
}
.outer-wrapper li:nth-of-type(4) input[type="radio"]:checked:after {
  color: white;
}
.outer-wrapper li:nth-of-type(5) input[type="radio"] {
  background-color: #F69890;
}
.outer-wrapper li:nth-of-type(5) input[type="radio"]:after {
  color: #F69890;
}
.outer-wrapper li:nth-of-type(5) input[type="radio"]:checked:after {
  color: white;
}
.outer-wrapper li:nth-of-type(6) input[type="radio"] {
  background-color: #F2653F;
}
.outer-wrapper li:nth-of-type(6) input[type="radio"]:after {
  color: #F2653F;
}
.outer-wrapper li:nth-of-type(6) input[type="radio"]:checked:after {
  color: white;
}
.outer-wrapper svg text {
  font-size: 0.8em;
  fill: #444;
}
.outer-wrapper .network-comments {
  margin: 0px 20px 20px;
}
.outer-wrapper .comment {
  font-style: italic;
}
.outer-wrapper .bio {
  text-transform: uppercase;
  font-weight: bold;
  color: #999;
}

</style>
<div class="status-message">
	<p>The interactive companion to these tables requires a modern browser (e.g. Chrome, Safari, Firefox or Internet Explorer 9+) with javascript enabled.</p>
	<p><a href="http://www.nature.com/news/social-networks-7.19050">How do you use this site professionally?</a></p>
	<p><a href="http://www.nature.com/news/comments-7.19051" >Respondent comments.</a></p>
</div>

<div class="outer-wrapper">
	<h2>Interactive: Why scholars use social media</h2>
	<p>In <em>Nature</em>'s survey, a subset of scholars who said they 'regularly visited' social media sites were quizzed in detail about their activities.</p>

	<div class="chart"></div>

	<form class="choose-network">
	</form>
	<div class="options"></div>

	<h3 class="comment-head">Voices from the survey</h3>
	<div class="network-comments">
		<blockquote class="comment"></blockquote>
		<cite class="bio"></cite>
	</div>
</div>


<!--[if gt IE 8]><!-->
<script type="text/javascript">
function buildCheckboxes (allSites, colour, strokeColour) {
	var format = d3.format("0,000");

	/* Create checkboxes for each site */
	d3.select(".outer-wrapper .choose-network")
		.append("ul")
		.attr("id","networkSelect")
		.selectAll('li')
	  .data(allSites)
	  	.enter()
		.append("li")
		.html(function (d, i) {
			var checked = (i === 0) ? 'checked':'';
			var siteName = d.site;
			var safeSiteName = siteName.toLowerCase().split('.').join("-");

			var innerHTML = "<input type='radio' id='" + safeSiteName + "' name='selectedSite' " + checked + "><label for='" + safeSiteName + "'>" + d.site + " (" + format(d.total )+ " regular visitors)</label>";

			return innerHTML;
		});
}
function fadeOutArcs (lowOpacityLevel) {
	function fadeOut (x) {
		d3.select(".chart").select("svg").selectAll(x)
			.transition()
			.duration(200)
			.attr('opacity', lowOpacityLevel);
	}

	function fadeIn (x) {
		d3.select(".chart").select("svg").selectAll(x)
			.transition()
			.duration(200)
			.attr('opacity', '0');
	}

	jQuery('#networkSelect').change(
		function () {
			var myValue = jQuery(this).find("input[type='radio']:checked").attr('id');

			console.log(myValue);

			if (jQuery('#Twitter').is(':checked')) {
				// fadeOut('path.Twitter');

			} else {
				// fadeIn('path.Twitter')
			}
			// if (jQuery('#Facebook').is(':checked')) {
			// 	fadeOut('path.Facebook');
			// } else {
			// 	fadeIn('path.Facebook')
			// }
			// if (jQuery('#AcademiaEdu').is(':checked')) {
			// 	fadeOut('path.AcademiaEdu');
			// } else {
			// 	fadeIn('path.AcademiaEdu')
			// }
			// if (jQuery('#ResearchGate').is(':checked')) {
			// 	fadeOut('path.ResearchGate');
			// } else {
			// 	fadeIn('path.ResearchGate')
			// }
			// if (jQuery('#LinkedIn').is(':checked')) {
			// 	fadeOut('path.LinkedIn');
			// } else {
			// 	fadeIn('path.LinkedIn')
			// }
			// if (jQuery('#Mendeley').is(':checked')) {
			// 	fadeOut('path.Mendeley');
			// } else {
			// 	fadeIn('path.Mendeley')
			// }


		}
	);
}

function buildSVG(margin, width, height) {
	d3.select(".outer-wrapper .chart").append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom);
}
function buildTicks (margin, width, height, radiusScale, scaleLines) {
	var myTicks = d3.select(".outer-wrapper .chart").select("svg").append("g")
		.attr("transform", "translate(" + (width + margin.left + margin.right) / 2 + "," + (height + margin.top + margin.bottom) / 2 + ")");

	myTicks.selectAll('text')
	  .data(scaleLines)
		.enter()
		.append('svg:text')
		.attr('y', function(d) { return -1 * radiusScale(d); })
		.attr("text-anchor", "middle")
		.attr("dy", ".35em")
		.text(function (d) {
			return d + "%";
		});
}
function buildList (options) {
	/* Create numbered list for options */
	d3.select(".outer-wrapper .options")
		.append("ol")
		.selectAll('li')
	  .data(options)
	  	.enter()
		.append("li")
		.html(function (d, i) {
			return d;
		});
}
function buildLabels (margin, width, height, smallLayout, radiusScale, scaleLines, options, baseRad) {

	/* http://bl.ocks.org/mbostock/7555321 */
	function wrap(text, width) {
		text.each(function() {
			var text = d3.select(this),
				words = text.text().split(/\s+/).reverse(),
				word,
				line = [],
				lineNumber = 0,
				lineHeight = 1.1, // ems
				x = text.attr("x"),
				y = text.attr("y"),
				dy = parseFloat(text.attr("dy")),
				tspan = text.text(null).append("tspan").attr("x", x).attr("y", y).attr("dy", dy + "em");
			while (word = words.pop()) {
				line.push(word);
				tspan.text(line.join(" "));
				if (tspan.node().getComputedTextLength() > width) {
					line.pop();
					tspan.text(line.join(" "));
					line = [word];
					tspan = text.append("tspan").attr("x", x).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
				}
			}
		});
	}

	var myLabels = d3.select(".outer-wrapper .chart").select("svg").append("g")
		.attr('class','options')
		.attr("transform", "translate(" + (width + margin.left + margin.right) / 2 + "," + (height + margin.top + margin.bottom) / 2 + ")");

	myLabels.selectAll('text')
		.data(options)
		.enter()
		.append('svg:text')
		.attr('x', function (d,i) {
			var xPos;
			if (smallLayout) {
				xPos = radiusScale(d3.max(scaleLines)*1.2) * Math.cos((baseRad*i) - (baseRad*3.25));
			} else {
				xPos = radiusScale(d3.max(scaleLines)*1.225) * Math.cos((baseRad*i) - (baseRad*3.25));				
			}
			return xPos;
		})
		.attr('y', function (d,i) {
			var yPos;
			if (smallLayout) {
				yPos = radiusScale(d3.max(scaleLines)*1.2) * Math.sin((baseRad*i) - (baseRad*3.25));
			} else {
				yPos = radiusScale(d3.max(scaleLines)*1.15) * Math.sin((baseRad*i) - (baseRad*3.25));				
			}
			return yPos;
		})
		.attr('text-anchor','middle')
		.attr("dy", function () {
			if (smallLayout) {
				return "0.35em";
			} else {
				return "0em";
			}
		})
		.text(function (d, i) {
			if (smallLayout) {
				return i + 1;
			} else {
				return d;
				
			}
		});
	
	d3.selectAll('.options text')
		.call(wrap, 100);
}
function buildLines (margin, width, height, radiusScale, scaleLines, dataSetLength, strokeColour, baseAngle) {
	var mylines = d3.select(".outer-wrapper .chart").select("svg").append("g")
			.attr("transform", "translate(" + (width + margin.left + margin.right) / 2 + "," + (height + margin.top + margin.bottom) / 2 + ")");

	for (var i = 0; i < dataSetLength; i++) {
		mylines.append('line')
			.attr('x1', '0')
			.attr('y1', '0')
			.attr('x2', '0')
			.attr('y2', -radiusScale(scaleLines[scaleLines.length-1]))
			.attr('stroke', strokeColour)
			.attr('stroke-width', function () {
				if (i === 2 || i === 6 || i === 12) {
					return '2px';
				} else {
					return '0.5px';
				}
			})
			.attr('fill','none')
			.attr('transform','rotate(' +  (baseAngle + ((baseAngle*2) * i)) + ')');
	}
}
function buildScales (margin, width, height, radiusScale, scaleLines, strokeColour) {
	
	var myScale = d3.select(".outer-wrapper .chart").select("svg").append("g")		
		.attr("transform", "translate(" + (width + margin.left + margin.right) / 2 + "," + (height + margin.top + margin.bottom) / 2 + ")");

	myScale.selectAll('circle')
	  .data(scaleLines)
	  	.enter()
	  	.append('circle')
		.attr('cx', 0)
		.attr('cy', 0)
		.attr('r', function (d) {
			return radiusScale(d);
		})
		.attr('fill', 'none')
		.attr('stroke', strokeColour)
		.attr('stroke-dasharray', '1, 3');
}
var buildGraphic = function(dataSet, margin, width, height, radiusScale, colour, baseRad, baseAngle, duration) {

	var myArc = d3.svg.arc();
		myArc.innerRadius(0);
		myArc.outerRadius(function (d) { return radiusScale(d); } );
		myArc.startAngle(function (d,i) { return baseRad * i; } );
		myArc.endAngle(function (d,i) { return baseRad * (i + 1); });

	var myGroup = d3.select(".outer-wrapper .chart").select("svg").append("g")
		.attr("transform", "translate(" + (width + margin.left + margin.right) / 2 + "," + (height + margin.top + margin.bottom) / 2 + "), rotate(" + (baseAngle * -1) +")");

	function buildArcs (x) {
		myGroup.selectAll("path")
		  .data(dataSet[x])
			.enter()
		  .append("path")
		  	.attr('class', 'segment')
			.attr('d', myArc)
			.attr('fill', function () {
				return colour[x];
			})
			.attr('stroke', 'none');
	}

	function updateGraphic (x) {
		myGroup.selectAll("path.segment")
		  .data(dataSet[x])
			.transition()
			.duration(duration)
			.attr('d', myArc)
			.attr('fill', function () {
				return colour[x];
			});
	}

	buildArcs(0);

	return {
		buildArcs: function (dataSet, margin, width, height, radiusScale, colour, baseRad, baseAngle, duration) {
			return processDate(dataSet, margin, width, height, radiusScale, colour, baseRad, baseAngle, duration);
		},
		updateGraphic: function (x) {
			return updateGraphic(x);
		}
	};
}
function buildDataSet (data) {
	var tableRows = jQuery(data).find("tbody tr");
	var headerRows = jQuery(data).find("thead tr").find('th');
	var rowLength = tableRows.eq(0).find('td').length - 1;

	var networkDataSet = {
		dataSet : [],
		options : [],
		allSites : []
	};
	for (var i = 0; i < tableRows.length; i++) {
		
		var myNewArray = [];

		networkDataSet.dataSet.push(myNewArray);

		for (var p = 1; p < (rowLength); p++) {
			networkDataSet.dataSet[i].push(tableRows.eq(i).find('td').eq(p).text());
		}

		var thisSite = {};

		thisSite.site = tableRows.eq(i).find('td').eq(0).text();
		thisSite.total = tableRows.eq(i).find('td').eq(rowLength).text();

		networkDataSet.allSites.push(thisSite);

	}

	for (var n = 1; n < headerRows.length -1; n++) {
		networkDataSet.options.push(headerRows.eq(n).text());
	}
	
	return networkDataSet;
}
function buildComments (data) {
	var commentRows = jQuery(data).find("tbody tr");
	var commentLowLength = commentRows.eq(0).find('td').length - 1;

	var comments = [[], [], [], [], [], [] ];

	function addComment (x) {
		var myArray = [];

		for (var p = 0; p <= (commentLowLength); p++) {
			myArray.push(commentRows.eq(x).find('td').eq(p).text());
		}

		return myArray;
	}

	for (var i = 0; i < commentRows.length; i++) {

		var thisSite = commentRows.eq(i).find('td').eq(0).text();

		switch (thisSite) {
			case 'Twitter':
				comments[0].push(addComment(i));
				break;
			case 'Facebook':
				comments[1].push(addComment(i));
				break;
			case 'LinkedIn':
				comments[2].push(addComment(i));
				break;
			case 'ResearchGate':
				comments[3].push(addComment(i));
				break;
			case 'Academia.edu':
				comments[4].push(addComment(i));
				break;
			case 'Mendeley':
				comments[5].push(addComment(i));
				break;
			default:
				break;
		}
	}
	return comments;
}
function updateComment (comment) {
	var myLength = comment.length;
	var myPick = Math.floor(Math.random() * myLength);
	
	var myComment = comment[myPick][1];
	var myBio = comment[myPick][0] + " user, Age " + comment[myPick][2] + ", " + comment[myPick][3] + ", " + comment[myPick][4];

	jQuery(".outer-wrapper .network-comments").fadeOut("fast", function () {
		jQuery(".outer-wrapper .network-comments > blockquote.comment").html("&#8220;" + myComment + "&#8221;");
		jQuery(".outer-wrapper .network-comments > cite.bio").html(myBio);	
	});
	jQuery(".outer-wrapper .network-comments").fadeIn();
}
(function() {
		var init = function($)
		{

		$(".status-message").css({"display":"none"});
		$(".outer-wrapper").css({"display":"block"});

		/*	==================================================================================== */
		/*	GLOBAL VARIABLES FOR D3 components */

		/*	Margin, Width and height */
		var outerwrapperWidth = $('.section').width();
		var smallLayout = false;

		if (outerwrapperWidth < 500) {
			smallLayout = true;
		}

		var margin = {top: 0, right: 100, bottom: 0, left: 100};

		if (smallLayout) {
			margin.right = 50;
			margin.left = 50;
		}

		var width = outerwrapperWidth - margin.left - margin.right;
		var height;

		if (smallLayout) {
			height = outerwrapperWidth - margin.top - margin.bottom;
		} else {
			height = (outerwrapperWidth*0.9) - margin.top - margin.bottom;
		}

		/*	Global variable to control the length of D3 transitons */
		var duration = 300;
		/*  Colours for the bars */
		var colour = ["#3CBAC8", "#B9B2D8", "#F68628", "#B9D98B", "#F69890", "#F2653F"];
		var strokeColour = "#666";
		var scaleLines = [10,20,30,40,50,60,70];
		var radiusScale;	
		var networkComments;
		var networkData;
		var baseRad;
		var baseAngle;

		/*	==================================================================================== */
		/*	jQuery ready */

			/*	==================================================================================== */
			/*	Load D3 */
			$.getScript("//www.nature.com/polopoly_static/js/d3.v3.min.js", function() {

				$.when($.ajax("//www.nature.com/news/social-networks-7.19050"), $.ajax("//www.nature.com/news/comments-7.19051")).done(function (a1, a2) {

					networkData = buildDataSet(a1[0]);
					networkComments = buildComments(a2[0]);				
	
					/* Scale for pie radius */
					radiusScale = d3.scale.linear()
										.domain([0,70])
										.range([0,(width/2)]);

					baseRad = (Math.PI * 2) / networkData.dataSet[0].length;
					baseAngle = 180 / networkData.dataSet[0].length;

					buildSVG(margin, width, height);
					buildCheckboxes(networkData.allSites, colour, strokeColour);

					var myGraphic = buildGraphic(networkData.dataSet, margin, width, height, radiusScale, colour, baseRad, baseAngle, duration);
					buildScales(margin, width, height, radiusScale, scaleLines, strokeColour);
					buildLines(margin, width, height, radiusScale, scaleLines, networkData.dataSet[0].length, strokeColour, baseAngle);

					if (smallLayout) {
						buildList(networkData.options);
					}

					buildLabels(margin, width, height, smallLayout, radiusScale, scaleLines, networkData.options, baseRad);
					buildTicks(margin, width, height, radiusScale, scaleLines);
					updateComment(networkComments[0]);

					$('#networkSelect').change(
						function () {
							var item = $(".outer-wrapper .choose-network #networkSelect input[type='radio']:checked");
							var myIndex = $('.outer-wrapper .choose-network #networkSelect input').index(item);

							myGraphic.updateGraphic(myIndex);
							updateComment(networkComments[myIndex]);
						}
					);

				});

			}); /* End of d3js getscript call */

		/* End of active code */
		};

	setTimeout(function()
	{
	if (typeof jQuery !== 'undefined')
	{
		init(jQuery);
	} else
	{
		setTimeout(arguments.callee, 60);
	}
	}, 60);

})();
</script>
<!--<![endif]-->
<!-- ========= PASTED POLOPOLY FOOTER BELOW ========= -->

</div>							
						</div>
					</section>
				</div>
			</article>
		</div>
	</div>
</div>
</div>
</body>
</html>