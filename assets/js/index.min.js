function buildCheckboxes(a,b){var c=d3.format("0,000");d3.select(".chooseNetwork").append("ul").attr("id","networkSelect").selectAll("li").data(a).enter().append("li").html(function(a,d){var e=0===d?"checked":"",f="<input type='radio' id='"+a.site+"' name='selectedSite' "+e+"><label for='"+a.site+"'><span><svg height='20' width='20'><circle cx='10' cy='10' r='10' fill='"+b[d]+"' class='dot"+d+"'></circle><polygon fill='#fff' points='8.163,11.837 6.062,9.737 3.963,11.837 6.062,13.938 8.163,16.037 16.037,8.162 13.938,6.062'/></polygon></svg></span> "+a.site+" ("+c(a.total)+" regular users)</label>";return f})}function fadeOutArcs(a){jQuery("#networkSelect").change(function(){var a=jQuery(this).find("input[type='radio']:checked").attr("id");console.log(a),jQuery("#Twitter").is(":checked")})}function buildSVG(a,b,c){d3.select(".chart").append("svg").attr("width",b+a.left+a.right).attr("height",c+a.top+a.bottom)}function buildTicks(a,b,c,d,e){var f=d3.select(".chart").select("svg").append("g").attr("transform","translate("+(b+a.left+a.right)/2+","+(c+a.top+a.bottom)/2+")");f.selectAll("text").data(e).enter().append("svg:text").attr("y",function(a){return-1*d(a)}).attr("text-anchor","middle").attr("dy",".35em").text(function(a){return a+"%"})}function buildList(a){d3.select(".options").append("ol").attr("id","optionDescriptions").selectAll("li").data(a).enter().append("li").html(function(a){return a})}function buildLabels(a,b,c,d,e,f,g,h){function i(a,b){a.each(function(){for(var a,c=d3.select(this),d=c.text().split(/\s+/).reverse(),e=[],f=0,g=1.1,h=c.attr("x"),i=c.attr("y"),j=parseFloat(c.attr("dy")),k=c.text(null).append("tspan").attr("x",h).attr("y",i).attr("dy",j+"em");a=d.pop();)e.push(a),k.text(e.join(" ")),k.node().getComputedTextLength()>b&&(e.pop(),k.text(e.join(" ")),e=[a],k=c.append("tspan").attr("x",h).attr("y",i).attr("dy",++f*g+j+"em").text(a))})}var j=d3.select(".chart").select("svg").append("g").attr("class","options").attr("transform","translate("+(b+a.left+a.right)/2+","+(c+a.top+a.bottom)/2+")");j.selectAll("text").data(g).enter().append("svg:text").attr("x",function(a,b){var c;return c=d?e(1.2*d3.max(f))*Math.cos(h*b-3.25*h):e(1.225*d3.max(f))*Math.cos(h*b-3.25*h)}).attr("y",function(a,b){var c;return c=d?e(1.2*d3.max(f))*Math.sin(h*b-3.25*h):e(1.15*d3.max(f))*Math.sin(h*b-3.25*h)}).attr("text-anchor","middle").attr("dy",function(){return d?"0.35em":"0em"}).text(function(a,b){return d?b+1:a}),d3.selectAll(".options text").call(i,100)}function buildLines(a,b,c,d,e,f,g,h){for(var i=d3.select(".chart").select("svg").append("g").attr("transform","translate("+(b+a.left+a.right)/2+","+(c+a.top+a.bottom)/2+")"),j=0;f>j;j++)i.append("line").attr("x1","0").attr("y1","0").attr("x2","0").attr("y2",-d(e[e.length-1])).attr("stroke",g).attr("stroke-width",function(){return 2===j||6===j||12===j?"2px":"0.5px"}).attr("fill","none").attr("transform","rotate("+(h+2*h*j)+")")}function buildScales(a,b,c,d,e,f){var g=d3.select(".chart").select("svg").append("g").attr("transform","translate("+(b+a.left+a.right)/2+","+(c+a.top+a.bottom)/2+")");g.selectAll("circle").data(e).enter().append("circle").attr("cx",0).attr("cy",0).attr("r",function(a){return d(a)}).attr("fill","none").attr("stroke",f).attr("stroke-dasharray","1, 3")}function buildGraphic(a,b,c,d,e,f,g,h,i){function j(b){m.selectAll("path").data(a[b]).enter().append("path").attr("d",l).attr("fill",function(){return f[b]}).attr("stroke","none")}function k(b){m.selectAll("path").data(a[b]).transition().duration(i).attr("d",l).attr("fill",function(){return f[b]})}var l=d3.svg.arc();l.innerRadius(0),l.outerRadius(function(a){return e(a)}),l.startAngle(function(a,b){return g*b}),l.endAngle(function(a,b){return g*(b+1)});var m=d3.select(".chart").select("svg").append("g").attr("transform","translate("+(c+b.left+b.right)/2+","+(d+b.top+b.bottom)/2+"), rotate("+-1*h+")");jQuery("#networkSelect").change(function(){var a=jQuery(".outerwrapper .chooseNetwork #networkSelect input[type='radio']:checked"),b=jQuery(".outerwrapper .chooseNetwork #networkSelect input").index(a);k(b)}),j(0)}function buildDataSet(a){for(var b=jQuery(a).find("tbody tr"),c=jQuery(a).find("thead tr").find("th"),d=b.eq(0).find("td").length-1,e={dataSet:[],options:[],allSites:[]},f=0;f<b.length;f++){e.dataSet.push(new Array);for(var g=1;d>g;g++)e.dataSet[f].push(b.eq(f).find("td").eq(g).text());var h=new Object;h.site=b.eq(f).find("td").eq(0).text(),h.total=b.eq(f).find("td").eq(d).text(),e.allSites.push(h)}for(var f=1;f<c.length-1;f++)e.options.push(c.eq(f).text());return e}function buildComments(a){function b(a){for(var b=[],e=1;d>e;e++)b.push(c.eq(a).find("td").eq(e).text());return b}for(var c=jQuery(a).find("tbody tr"),d=c.eq(0).find("td").length-1,e={twitterComments:[],facebookComments:[],academiaeduComments:[],researchgateComments:[],linkedinComments:[],mendeleyComments:[]},f=0;f<c.length;f++){var g=c.eq(f).find("td").eq(0).text();switch(g){case"Twitter":e.twitterComments.push(b(f));break;case"Facebook":e.facebookComments.push(b(f));break;case"Academia.edu":e.academiaeduComments.push(b(f));break;case"ReseachGate":e.researchgateComments.push(b(f));break;case"LinkedIn":e.linkedinComments.push(b(f));break;case"Mendeley":e.mendeleyComments.push(b(f))}}return e}!function(){var a=function(a){var b=a(".section").width(),c=!1;500>b&&(c=!0);var d={top:0,right:100,bottom:0,left:100};c&&(d.right=50,d.left=50);var e,f=b-d.left-d.right;e=c?b-d.top-d.bottom:.9*b-d.top-d.bottom;var g,h,i,j,k,l=300,m=["#3CBAC8","#B9B2D8","#F68628","#B9D98B","#F69890","#F2653F"],n="#666",o=[10,20,30,40,50,60,70];a.getScript("https://poly-admin1.nature.com/polopoly_static/js/d3.v3.min.js",function(){a.when(a.ajax("https://poly-admin1.nature.com/preview/www/2.788/1.15117/7.18701"),a.ajax("https://poly-admin1.nature.com/preview/www/2.788/1.15117/7.18992")).done(function(a,b){i=buildDataSet(a[0]),h=buildComments(b[0]),g=d3.scale.linear().domain([0,70]).range([0,f/2]),j=2*Math.PI/i.dataSet[0].length,k=180/i.dataSet[0].length,buildSVG(d,f,e),buildCheckboxes(i.allSites,m,n),buildGraphic(i.dataSet,d,f,e,g,m,j,k,l),buildScales(d,f,e,g,o,n),buildLines(d,f,e,g,o,i.dataSet[0].length,n,k),c&&buildList(options),buildLabels(d,f,e,c,g,o,i.options,j),buildTicks(d,f,e,g,o)})})};setTimeout(function(){"undefined"!=typeof jQuery?a(jQuery):setTimeout(arguments.callee,60)},60)}();